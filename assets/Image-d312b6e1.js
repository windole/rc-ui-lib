import{j as n,c as i}from"./locales-548059eb.js";import{r as c}from"./react-libs-840bfe49.js";import{a as g}from"./index-59db7e48.js";import{C as L}from"./ConfigProviderContext-0f984393.js";import{u as z}from"./use-set-state-898f20ed.js";import{u as U}from"./use-update-effect-09c1ca0c.js";import{i as d}from"./base-1da74170.js";import{a as m}from"./unit-bb3e6514.js";const h=e=>{const{prefixCls:x,createNamespace:C}=c.useContext(L),[t]=C("image",x),[l,s]=z({loading:!0,error:!1}),o=c.useRef(null),I=c.useRef(!1),{fit:j,errorIcon:f,loadingIcon:u,showError:E,showLoading:k,block:w}=e,N=c.useMemo(()=>{const r={};return d(e.width)&&(r.width=m(e.width)),d(e.height)&&(r.height=m(e.height)),d(e.radius)&&(r.overflow="hidden",r.borderRadius=m(e.radius)),r},[]);c.useEffect(()=>(o.current&&o.current.complete&&s({loading:!1,error:!1}),()=>{I.current=!0}),[]),U(()=>{o.current&&!o.current.complete&&s({error:!1,loading:!0})},[e.src]);const P=r=>{var a;s({loading:!1}),(a=e.onLoad)==null||a.call(e,r)},R=r=>{var a;s({loading:!1,error:!0}),(a=e.onError)==null||a.call(e,r)},S=()=>typeof u!="string"?u:n.jsx(g,{size:e.iconSize,name:u,className:i(t("loading-icon")),classPrefix:e.iconPrefix}),b=()=>typeof f!="string"?f:n.jsx(g,{size:e.iconSize,name:f,className:i(t("error-icon")),classPrefix:e.iconPrefix}),v=()=>l.loading&&k?n.jsx("div",{className:i(t("loading")),onClick:e.onClick,children:S()}):l.error&&E?n.jsx("div",{className:i(t("error")),onClick:e.onClick,children:b()}):null,y=()=>{if(l.error||!e.src)return null;const r={className:i(t("img")),style:{objectFit:j}};return n.jsx("img",{ref:o,alt:e.alt||"img",src:e.src,onLoad:P,onError:R,...r})};return n.jsxs("div",{className:i(e.className,t({block:w,round:e.round})),style:N,onClick:e.onClick,children:[y(),v(),e.children]})};h.defaultProps={fit:"fill",errorIcon:"photo-fail",loadingIcon:"photo",showError:!0,showLoading:!0,block:!0};const H=h;export{H as I};
