import{j as d,c as m}from"./locales-548059eb.js";import{r as u}from"./react-libs-840bfe49.js";import{u as p}from"./use-touch-76dedc34.js";import{g as L}from"./use-scroll-parent-a4dd715d.js";import{u as w}from"./use-event-listener-721bbec6.js";import{L as A}from"./Loading-c60598b2.js";import{C as M}from"./ConfigProviderContext-0f984393.js";import{u as U}from"./use-set-state-898f20ed.js";import{u as _}from"./use-update-effect-09c1ca0c.js";import{p as F}from"./event-07a78c2b.js";import{g as G}from"./scroll-e4e20d56.js";const I=50,V=["pulling","loosing","success"],y=e=>{const{prefixCls:E,createNamespace:v}=u.useContext(M),[c]=v("pull-refresh",E),{disabled:g,animationDuration:T}=e,C=u.useRef(),[s,n]=U({refreshing:!1,status:"normal",distance:0,duration:0}),x=u.useRef(),o=u.useRef(null),r=p(),R=()=>e.headHeight!==I?{height:`${e.headHeight}px`}:null,l=u.useCallback(()=>s.status!=="loading"&&s.status!=="success"&&!g,[s.status,g]),j=t=>{const a=+(e.pullDistance||e.headHeight);return t>a&&(t<a*2?t=a+(t-a)/2:t=a*1.5+(t-a*2)/4),Math.round(t)},i=(t,a)=>{const f=+(e.pullDistance||e.headHeight),h={distance:t};a?h.status="loading":t===0?h.status="normal":t<f?h.status="pulling":h.status="loosing",n(h)},S=()=>s.status==="normal"?"":e[`${s.status}Text`],N=()=>{const{status:t,distance:a}=s;if(typeof e[`${s.status}Text`]=="function")return e[`${s.status}Text`]({distance:a});const f=[];return V.includes(t)&&f.push(d.jsx("div",{className:m(c("text")),children:S()},"text")),t==="loading"&&f.push(d.jsx(A,{className:m(c("loading")),children:S()},"loading")),f},P=()=>{n({status:"success"}),setTimeout(()=>{i(0)},+e.successDuration)},$=async()=>{try{n({refreshing:!0}),await e.onRefresh(),n({refreshing:!1})}catch{n({refreshing:!1})}},D=t=>{const a=L(t.target);o.current=G(a)===0,o.current&&(n({duration:0}),r.start(t))},k=t=>{l()&&D(t.nativeEvent)},b=u.useCallback(t=>{l()&&(o.current||D(t),r.move(t),o.current&&r.deltaY.current>=0&&r.isVertical()?(i(j(r.deltaY.current)),F(t)):i(0))},[o.current,r.deltaY,l]),H=async()=>{o.current&&r.deltaY&&l()&&(n({duration:+T}),s.status==="loosing"?(i(+e.headHeight,!0),$()):i(0))};w("touchmove",b,{target:x.current,depends:[o.current,l(),r.deltaY]}),_(()=>{n({duration:+T}),s.refreshing?i(+e.headHeight,!0):e.successText?P():i(0,!1)},[s.refreshing]);const Y=u.useMemo(()=>({transitionDuration:`${s.duration}ms`,transform:s.distance?`translate3d(0,${s.distance}px, 0)`:""}),[s.duration,s.distance]);return d.jsx("div",{ref:C,className:m(e.className,c()),style:e.style,children:d.jsxs("div",{ref:x,className:m(c("track")),style:Y,onTouchStart:k,onTouchEnd:H,onTouchCancel:H,children:[d.jsx("div",{className:m(c("head")),style:R(),children:N()}),e.children]})})};y.defaultProps={headHeight:50,animationDuration:300,successDuration:500,pullingText:"下拉即可刷新...",loosingText:"释放即可刷新...",loadingText:"加载中..."};const et=y;export{et as P};
