import{c as x,j as m}from"./locales-548059eb.js";import{r as o}from"./react-libs-840bfe49.js";import{u as te,a as ne,b as se}from"./use-gesture-react.esm-484f41f1.js";import{i as re,c as q,e as oe}from"./base-1da74170.js";import{b as ie}from"./bound-41eb6e06.js";import{C as Z}from"./ConfigProviderContext-0f984393.js";import{u as ce}from"./use-set-state-898f20ed.js";import{u as ae}from"./use-update-effect-09c1ca0c.js";import{r as Q}from"./number-b57f7cd4.js";import{L as le}from"./Loading-c60598b2.js";import{u as ue}from"./use-refs-92151253.js";import{e as fe}from"./constant-7552c2aa.js";import{u as me}from"./use-event-listener-721bbec6.js";import{p as de}from"./event-07a78c2b.js";import{u as he}from"./unit-bb3e6514.js";const{hasOwnProperty:ge}=Object.prototype;function xe(e,r,c){const y=r[c];re(y)&&(!ge.call(e,c)||!q(y)?e[c]=y:e[c]=p(Object(e[c]),r[c]))}function p(e,r){return Object.keys(r).forEach(c=>{xe(e,r,c)}),e}function _(e){return Array.isArray(e)?e.map(r=>_(r)):typeof e=="object"?p({},e):e}function W(e,r,c){return e*r*c/(r+c*e)}function Ce(e,r,c,y,f=.15){return f===0?ie(e,r,c):e<r?-W(r-e,y,f)+r:e>c?+W(e-c,y,f)+c:e}function X(e){return q(e)&&e.disabled}const Y=200,be=15,ee=o.memo(o.forwardRef((e,r)=>{const{prefixCls:c,createNamespace:y}=o.useContext(Z),[f]=y("picker-column",c),{itemHeight:C,visibleItemCount:S,defaultIndex:P,initialOptions:N}=e,$=o.useRef(null),D=o.useRef(null),l=o.useRef(P),d=o.useRef(_(N)),[I,h]=ce({offset:0,duration:0,options:_(N)}),E=o.useMemo(()=>d.current.length,[d.current.length]),O=o.useMemo(()=>C*(+S-1)/2,[C,S]),v=o.useRef(!1),[{y:V},k]=te(()=>({from:{y:P*-C+O},config:{tension:400,mass:.8}})),R=s=>{s=Q(s,0,E);for(let a=s;a<E;a+=1)if(!X(d.current[a]))return a;return null},b=(s,a)=>{s=R(s)||0;const u=s*-C;k.start({y:u+O}),s!==l.current&&(l.current=s,a&&e.onChange&&setTimeout(()=>{e.onChange(s)},0)),h({offset:u})},H=s=>{JSON.stringify(s)!==JSON.stringify(d.current)&&(d.current=s,b(e.defaultIndex))},j=s=>{v.current||e.readonly||(h({duration:Y}),b(s,!0))};function K(s){return q(s)&&e.textKey in s}const B=s=>K(s)?s[e.textKey]:s,M=s=>Q(Math.round(-s/e.itemHeight),0,E-1),L=ne(s=>{if(!e.readonly)if(v.current=!0,s.tap)h({duration:0,offset:s.offset[1]});else if(s.last){const a=Math.abs(s.velocity[1]*s.direction[1]*50)>be,u=s.offset[1]+s.velocity[1]*s.direction[1]*50-O,T=M(u);h({duration:a?+e.swipeDuration:Y,offset:u+O}),b(T,!0)}else{const a=s.offset[1],u=O,T=-(E*C)+O,w=Ce(a,T,u,C*50,.2);k.start({y:w})}},{axis:"y",from:()=>[0,V.get()],filterTaps:!0,pointer:{touch:!0}}),U=o.useMemo(()=>{const s={height:`${e.itemHeight}px`};return d.current.map((a,u)=>{const T=B(a),w=X(a),J={role:"button",key:u,style:s,tabIndex:w?-1:0,className:x(f("item",{disabled:w,selected:u===l.current})),onClick:()=>{v.current=!1,j(u)}},z={className:"rc-ellipsis",children:T};return m.jsx("li",{...J,children:e.optionRender?e.optionRender(a):m.jsx("div",{...z})})})},[d.current,l.current,j,e.optionRender]),F=s=>{const a=d.current;for(let u=0;u<a.length;u+=1)if(B(a[u])===s)return b(u);return null},A=o.useCallback(()=>d.current[l.current],[l.current,d.current]);return o.useEffect(()=>{b(P)},[P]),ae(()=>{H(_(N))},[N]),o.useImperativeHandle(r,()=>({state:I,getIndex:()=>l.current,getOptions:()=>d.current,setIndex:b,getValue:A,setValue:F,setOptions:H})),m.jsx("div",{ref:$,className:x(f(),e.className),...L(),children:m.jsx(se.ul,{ref:D,className:x(f("wrapper")),style:{y:V,transitionDuration:`${I.duration}ms`,transitionProperty:I.duration?"all":"none"},"aria-hidden":!0,children:U})})}),(e,r)=>!(e.index!==r.index||e.textKey!==r.textKey||JSON.stringify(e.initialOptions)!==JSON.stringify(r.initialOptions)));ee.displayName="PickerColumn";const ye=ee,G=o.forwardRef((e,r)=>{const{prefixCls:c,createNamespace:y}=o.useContext(Z),[f]=y("picker",c),[C,S]=ue(),[P,N]=o.useState([]),{text:$,values:D,children:l}=oe({text:"text",values:"values",children:"children"},e.columnsFieldNames),d=o.useRef(null),I=o.useMemo(()=>he(e.itemHeight),[e.itemHeight]),h=o.useMemo(()=>{const{columns:t}=e,n=t[0]||{};if(typeof n=="object"){if(l in n)return"cascade";if(D in n)return"object"}return"plain"},[e.columns]),E=()=>{const t=[];let n={[l]:e.columns};for(;n&&n[l];){const i=n[l];let g=n.defaultIndex??+e.defaultIndex;for(;i[g]&&i[g].disabled;)if(g<i.length-1)g++;else{g=0;break}t.push({[D]:n[l],className:n.className,defaultIndex:g}),n=i[g]}N(t)},O=()=>{const{columns:t}=e;h==="plain"?N([{[D]:t}]):h==="cascade"?E():N(t)},v=()=>C.map(t=>t.getIndex()),V=(t,n)=>{const i=C[t];i&&i.setOptions(n)},k=t=>{let n={[l]:e.columns};const i=v();for(let g=0;g<=t;g+=1)n=n[l][i[g]];for(;n&&n[l];)t+=1,V(t,n[l]),n=n[l][n.defaultIndex||0]},R=t=>C[t],b=t=>{const n=R(t);return(n==null?void 0:n.getValue())||void 0},H=(t,n)=>{const i=R(t);i&&(i.setValue(n),h==="cascade"&&k(t))},j=t=>{const n=R(t);return(n==null?void 0:n.getIndex())||0},K=(t,n)=>{const i=R(t);i&&(i.setIndex(n),h==="cascade"&&k(t))},B=t=>{const n=R(t);return n==null?void 0:n.getOptions()},M=()=>C.map(t=>t.getValue()),L=t=>{t.forEach((n,i)=>{H(i,n)})},U=t=>{t.forEach((n,i)=>{K(i,n)})},F=t=>{h==="cascade"&&k(t),e.onChange&&(h==="plain"?e.onChange(b(0),j(0)):e.onChange(M(),t))},A=()=>{e.onConfirm&&(h==="plain"?e.onConfirm(b(0),j(0)):e.onConfirm(M(),v()))},s=()=>{var t,n;h==="plain"?(t=e.onCancel)==null||t.call(e,b(0),j(0)):(n=e.onCancel)==null||n.call(e,M(),v())},a=()=>e.title?m.jsx("div",{className:x(f("title"),"rc-ellipsis"),children:e.title}):null,u=()=>{const t=e.cancelButtonText||"取消";return m.jsx("button",{type:"button",className:x(f("cancel")),onClick:s,children:t})},T=()=>{const t=e.confirmButtonText||"确认";return m.jsx("button",{type:"button",className:x(f("confirm")),onClick:A,children:t})},w=()=>e.showToolbar?m.jsx("div",{className:x(f("toolbar")),children:e.toolbar||m.jsxs(m.Fragment,{children:[u(),a(),T()]})}):null,J=()=>P.map((t,n)=>m.jsx(ye,{optionRender:e.optionRender,ref:S(n),textKey:$,readonly:e.readonly,className:t.className,itemHeight:I,defaultIndex:t.defaultIndex??+e.defaultIndex,swipeDuration:e.swipeDuration,visibleItemCount:e.visibleItemCount,initialOptions:t[D],onChange:()=>{F(n)}},String(n))),z=()=>{const t=I*e.visibleItemCount,n={height:`${I}px`},i={height:`${t}px`},g={backgroundSize:`100% ${(t-I)/2}px`};return m.jsxs("div",{ref:d,className:x(f("columns")),style:i,children:[J(),m.jsx("div",{className:x(f("mask")),style:g}),m.jsx("div",{className:x(fe,f("frame")),style:n})]})};return o.useEffect(()=>{O()},[e.columns]),me("touchmove",de,{target:d.current,depends:[d.current]}),o.useImperativeHandle(r,()=>({confirm:A,getValues:M,setValues:L,getIndexes:v,setIndexes:U,getColumnIndex:j,setColumnIndex:K,getColumnValue:b,setColumnValue:H,getColumnValues:B,setColumnValues:V})),m.jsxs("div",{className:x(f(),e.className),children:[e.toolbarPosition==="top"?w():null,e.loading?m.jsx(le,{className:x(f("loading"))}):null,e.columnsTop,z(),e.columnsBottom,e.toolbarPosition==="bottom"?w():null]})});G.defaultProps={itemHeight:44,visibleItemCount:5,swipeDuration:1e3,defaultIndex:0,showToolbar:!0,toolbarPosition:"top"};G.displayName="Picker";const Se=G;export{Se as P};
