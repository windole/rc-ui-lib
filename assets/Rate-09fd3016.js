import{j as f,c as d}from"./locales-548059eb.js";import{r as m}from"./react-libs-840bfe49.js";import{u as G}from"./use-merged-state-79e14435.js";import{C as J}from"./ConfigProviderContext-0f984393.js";import{u as K}from"./use-touch-76dedc34.js";import{u as O}from"./use-refs-92151253.js";import{u as Q}from"./usePassiveHandler-330dfdb1.js";import{a as V}from"./index-59db7e48.js";import{a as W}from"./unit-bb3e6514.js";const Y=(a,r,o,s)=>a>=r?{status:"full",value:1}:a+.5>=r&&o&&!s?{status:"half",value:.5}:a+1>=r&&o&&s?{status:"half",value:Math.round((a-r+1)*1e10)/1e10}:{status:"void",value:0},k=({count:a,touchable:r,onChange:o,...s})=>{const{prefixCls:g,createNamespace:E}=m.useContext(J),[n]=E("rate",g),[h,B]=G({value:s.value,defaultValue:s.defaultValue}),X=m.useRef(null),v=K(),[$,p]=O(),y=()=>s.readonly||s.disabled||!r,A=m.useMemo(()=>Array(a).fill("").map((t,e)=>Y(h,e+1,s.allowHalf,s.readonly)),[h,a]),l=m.useRef(),I=()=>{const t=$.map(e=>e.getBoundingClientRect());l.current=[],t.forEach((e,c)=>{s.allowHalf?l.current.push({score:c+.5,left:e.left},{score:c+1,left:e.left+e.width/2}):l.current.push({score:c+1,left:e.left})})},x=t=>{for(let e=l.current.length-1;e>0;e--)if(t>l.current[e].left)return l.current[e].score;return s.allowHalf?.5:1},P=t=>{!s.disabled&&!s.readonly&&t!==h&&(B(t),o==null||o(t))},F=t=>{y()||(v.start(t),I())},L=t=>{if(!y()&&(v.move(t),v.isHorizontal())){const{clientX:e}=t.touches[0];P(x(e))}};Q();const U=(t,e)=>{const{icon:c,size:S,color:j,gutter:C,voidIcon:H,voidColor:w,disabled:i,disabledColor:M,allowHalf:N,iconPrefix:T}=s,R=e+1,b=t.status==="full",u=t.status==="void",_=N&&t.value>0&&t.value<1;let z;C&&R!==+a&&(z={paddingRight:W(C)});const q=D=>{I(),P(N?x(D.clientX):R)};return f.jsxs("div",{ref:p(e),role:"radio",style:z,className:d(n("item")),tabIndex:0,"aria-setsize":parseInt(a==null?void 0:a.toString(),10),"aria-posinset":R,"aria-checked":!u,onClick:q,children:[f.jsx(V,{size:S,name:b?c:H,className:d(n("icon",{disabled:i,full:b})),color:i?M:b?j:w,classPrefix:T}),_&&f.jsx(V,{size:S,style:{width:`${t.value}em`},name:u?H:c,className:d(n("icon",["half",{disabled:i,full:!u}])),color:i?M:u?w:j,classPrefix:T})]},e)};return f.jsx("div",{ref:X,role:"radiogroup",className:d(n({readonly:s.readonly,disabled:s.disabled})),tabIndex:0,onTouchStart:t=>F(t),onTouchMove:t=>L(t),children:A.map(U)})};k.defaultProps={size:20,count:5,gutter:4,icon:"star",voidIcon:"star-o",touchable:!0};const nt=k;export{nt as R};
