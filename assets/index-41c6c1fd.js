import{j as r,c as g}from"./locales-548059eb.js";import{r as n}from"./react-libs-840bfe49.js";import{c as F}from"./rc-cli_site-mobile-demo-eaa39090.js";import{L as H}from"./Loading-c60598b2.js";import{g as N}from"./get-rect-4dc7f7e4.js";import{u as z}from"./use-scroll-parent-a4dd715d.js";import{u as A}from"./use-event-listener-721bbec6.js";import{C as I}from"./ConfigProviderContext-0f984393.js";import{u as U}from"./use-set-state-898f20ed.js";import{u as y}from"./use-update-effect-09c1ca0c.js";import{i as V}from"./Sticky-3cb62dae.js";import{P as $}from"./PullRefresh-d3068bed.js";import{T}from"./index-439e92ef.js";import{C as S}from"./index-9549eced.js";import"./mobile-e0307386.js";import"./unit-bb3e6514.js";import"./base-1da74170.js";import"./scroll-e4e20d56.js";import"./raf-f0838b14.js";import"./use-touch-76dedc34.js";import"./event-07a78c2b.js";import"./use-refs-92151253.js";import"./index-59db7e48.js";import"./index-945c9dff.js";import"./use-gesture-react.esm-484f41f1.js";import"./use-ref-state-6962d29d.js";import"./bound-41eb6e06.js";import"./use-mounted-ref-49b7ba77.js";import"./interceptor-35467a90.js";import"./constant-7552c2aa.js";import"./PopupContext-0557b73d.js";const _=n.forwardRef((e,u)=>{const{prefixCls:l,createNamespace:L}=n.useContext(I),[s]=L("list",l),[a,c]=U({loading:e.loading,error:e.error}),f=n.useRef(e.error),m=n.useRef(),d=n.useRef(null),h=n.useRef();d.current=z(m);const o=async()=>{if(!e.onLoad||a.loading||e.finished||f.current)return;const{offset:t,direction:E}=e,x=N(d.current);if(!x.height||V(m.current))return;let P=!1;const v=N(h.current);if(E==="up"?P=x.top-v.top<=+t:P=v.bottom-x.bottom<=+t,P)try{c({loading:!0}),e.onLoad&&await e.onLoad(),c({loading:!1})}catch(D){console.warn("onLoad error:",D),c({loading:!1,error:!0}),f.current=!0}},R=()=>e.finished&&e.finishedText?r.jsx("div",{className:g(s("finished-text")),children:e.finishedText}):null,C=()=>{c({error:!1}),f.current=!1,o()},j=()=>a.error&&e.errorText?r.jsx("div",{className:g(s("error-text")),onClick:C,children:e.errorText}):null,w=()=>a.loading&&!e.finished?r.jsx("div",{className:g(s("loading")),children:n.isValidElement(e.loadingText)?e.loadingText:r.jsx(H,{className:g(s("loading-icon")),size:16,children:e.loadingText})}):null;y(()=>{e.autoCheck&&o()},[a.loading,e.finished,e.error]),y(()=>{c({loading:e.loading,error:e.error}),f.current=e.error},[e.loading,e.error]),y(()=>{d.current&&e.immediateCheck&&o()},[d.current]),A("scroll",o,{target:d.current,depends:[a.loading,e.finished,a.error]}),n.useImperativeHandle(u,()=>({check:o,state:a}));const i=r.jsx("div",{ref:h,className:g(s("placeholder"))});return r.jsxs("div",{ref:m,role:"feed",className:g(s()),"aria-busy":a.loading,children:[e.direction==="down"?e.children:i,w(),R(),j(),e.direction==="up"?e.children:i]})});_.defaultProps={offset:300,direction:"down",immediateCheck:!0,autoCheck:!0,loadingText:"加载中...",finishedText:"没有更多了"};const k=_;async function b(e){return new Promise((u,l)=>{setTimeout(()=>{e&&l(new Error("error")),u(Array.from({length:10},(L,s)=>s))},1e3)})}const je=()=>{const{DemoSection:e}=F,u=n.useRef(null),[l,L]=n.useState([]),[s,a]=n.useState(0),[c,f]=n.useState([]),[m,d]=n.useState([]),[h,o]=n.useState(!1),R=async()=>{const i=await b();L(t=>[...t,...i]),l.length>=30&&o(!0)},C=async()=>{a(t=>t+1);const i=await b(s===1);f(t=>[...t,...i])};n.useEffect(()=>{c.length>=30&&o(!0)},[c]);const j=async i=>{const t=await b();d(E=>{const x=i?t:[...E,...t];return x.length>=30&&o(!0),x})},w=async()=>{var i;o(!1),await j(1),(i=u.current)==null||i.check()};return r.jsx(e,{children:r.jsxs(T,{sticky:!0,onChange:()=>o(!1),children:[r.jsx(T.TabPane,{title:"基本用法",children:r.jsx(k,{finished:h,onLoad:R,children:l.length?l.map((i,t)=>r.jsx(S,{title:t+1},t)):null})}),r.jsx(T.TabPane,{title:"错误提示",children:r.jsx(k,{finished:h,errorText:"请求失败，点击重新加载",onLoad:C,children:c.length?c.map((i,t)=>r.jsx(S,{title:t+1},t)):null})}),r.jsx(T.TabPane,{title:"下拉刷新",children:r.jsx($,{onRefresh:w,children:r.jsx(k,{ref:u,finished:h,onLoad:j,children:m.length?m.map((i,t)=>r.jsx(S,{title:t+1},t)):null})})})]})})};export{je as default};
