import{j as c,c as y}from"./locales-548059eb.js";import{c as Y}from"./rc-cli_site-mobile-demo-eaa39090.js";import{r as d}from"./react-libs-840bfe49.js";import{C as O}from"./ConfigProviderContext-0f984393.js";import{L as Z}from"./Loading-c60598b2.js";import"./mobile-e0307386.js";import"./unit-bb3e6514.js";import"./base-1da74170.js";const ee=typeof window<"u",S="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",C=["scroll","wheel","resize","mousewheel","animationend","transitionend","touchmove"],H=ee&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype,h={event:"event",observer:"observer"};function N(t,s){t instanceof HTMLIFrameElement||t instanceof HTMLImageElement||t instanceof HTMLMediaElement?t.src=s:t.style.backgroundImage=`url('${s}')`}function k(t){return new Promise((s,a)=>{const e=new Image;e.onload=()=>s(t),e.onerror=n=>a(n),e.src=t})}function A(t,s){t.className.includes(s)||(t.className+=` ${s}`)}function te(t,s=250,a){let e,n;return()=>{const o=a||this,r=+new Date,i=arguments;e&&r<e+s?(clearTimeout(n),n=setTimeout(()=>{e=r,t.apply(o,i)},s)):(e=r,t.apply(o,i))}}function se(t,s,a){let e,n,o,r,i;const l=function m(){const u=+new Date-r;u<s&&u>=0?e=setTimeout(m,s-u):(e=null,a||(i=t.apply(o,n),e||(o=null,n=null)))};return function(){o=this,n=arguments,r=+new Date;const u=a&&!e;return e||(e=setTimeout(l,s)),u&&(i=t.apply(o,n),o=null,n=null),i}}let B=!1;try{const t=Object.defineProperty({},"passive",{get(){B=!0}});window.addEventListener("test",null,t)}catch{}const V=B?{capture:!1,passive:!0}:!1,ne=t=>{const{listenEvents:s=C,offset:a,scrollContainer:e,debounce:n,throttle:o}=t,[r,i]=d.useState(!1),l=d.useRef(null);return d.useEffect(()=>{let m=()=>{var R;if(!l.current)return;const{top:u,left:v,width:E,height:p}=(R=l.current)==null?void 0:R.getBoundingClientRect(),{top:b,left:f,width:x,height:j}=e.getBoundingClientRect(),g=window.innerHeight||document.documentElement.clientHeight,L=window.innerWidth||document.documentElement.clientWidth,I=Math.min(b,0),$=Math.min(f,0),J=Math.min(g,b+j)-I,K=Math.min(L,f+x)-$,T=u-I,M=v-$,w=Array.isArray(a)?a:[a,a],P=T-w[0]<=J&&T+p+w[0]>=0&&M-w[1]<=K&&M+E+w[1]>=0;i(P),P&&s.forEach(X=>{e==null||e.removeEventListener(X,m)})};return n?m=se(m,n):o&&(m=te(m,o)),s.forEach(u=>{e==null||e.addEventListener(u,m,V)}),m(),()=>{s.forEach(u=>{e==null||e.removeEventListener(u,m,V)})}},[e]),[l,r]},D=ne,_=t=>{const{prefixCls:s,createNamespace:a}=d.useContext(O),[e]=a("lazyload",s),{children:n,loading:o,scrollContainer:r,listenEvents:i,offset:l,debounce:m,throttle:u,height:v,className:E,style:p}=t,[b,f]=D({listenEvents:i,offset:l,scrollContainer:r,debounce:m,throttle:u});return c.jsx("div",{className:y(e(),E),style:p,ref:b,children:f?n:o||c.jsx("div",{style:{height:v},className:y(e("placeholder"))})})};_.defaultProps={loading:null,className:"",height:0,listenEvents:C,scrollContainer:document.body,offset:0,debounce:300,throttle:0};const oe=_,re=(t,s)=>{const[a,e]=d.useState(null),n=d.useCallback(o=>{e(o)},[]);return d.useEffect(()=>{if(!a)return;const o=new IntersectionObserver(s,t);return o.observe(a),()=>o&&o.disconnect&&o.disconnect()},[s,t,a]),n},F=re,ae={threshold:[0,1]},ce=(t,s=ae)=>{const[a,e]=d.useState(t),n=()=>{e(!0)};d.useEffect(()=>{t&&n()},[t]);const o=d.useCallback(i=>{i.filter(l=>l.isIntersecting).forEach(l=>{const m=l.target;A(m,"rc-lazyload__loaded"),e(!0)})},[e,a]);return[F(s,o),a]},ie=ce,W=t=>{const{prefixCls:s,createNamespace:a}=d.useContext(O),[e]=a("lazyload",s),{children:n,forceVisible:o,className:r,height:i,style:l,loading:m}=t,[u,v]=ie(o);return c.jsx("div",{className:y(e(),r),style:l,ref:u,children:v?n:m||c.jsx("div",{style:{height:i},className:y(e("placeholder"))})})};W.defaultProps={loading:null,forceVisible:!1,height:0,className:"",style:{}};const le=W,U=t=>{const[s,a]=d.useState(),{observer:e,eventOptions:n,...o}=t;return d.useEffect(()=>{(i=>{!H&&i===h.observer&&(i=h.event),a(i)})(e?h.observer:h.event)},[e]),c.jsx(c.Fragment,{children:s===h.event?c.jsx(oe,{...o,...n}):s===h.observer?c.jsx(le,{...o}):null})};U.defaultProps={loading:null,height:0,observer:!0};const de=U,G=t=>{const{prefixCls:s,createNamespace:a}=d.useContext(O),[e]=a("lazyload-image",s),{className:n,type:o,style:r,image:i,errorImage:l,loading:m,eventOptions:u,height:v,width:E,onLoaded:p,...b}=t,[f,x]=D(u);d.useEffect(()=>{if(x&&f.current){const g=f.current,L=g.dataset.src||"";k(L).catch(()=>{N(g,l),A(g,e("error"))}).then(I=>{N(g,I),A(g,e("loaded")),g.setAttribute("lazy","loaded"),g.removeAttribute("data-src"),p==null||p()})}},[x]);const j={...r,height:v,width:E};return c.jsx(c.Fragment,{children:o==="image"?d.createElement("img",{...b,ref:f,style:j,"data-src":i,src:m||S,className:y(e(),n)}):d.createElement("div",{...b,ref:f,style:j,"data-src":i,className:y(e(),n)},t.children)})};G.defaultProps={loading:null,eventOptions:{listenEvents:C,scrollContainer:document.body,offset:0,debounce:300,throttle:0},type:"image",errorImage:S};const me=G,ue={threshold:[0,1]},fe=(t=ue,s)=>{const[a,e]=d.useState(!1),n=d.useCallback(r=>{r.filter(i=>i.isIntersecting).forEach(i=>{const l=i.target,m=l.dataset.src||"";k(m).catch(()=>{N(l,s),A(l,"rc-lazyload__error"),l.setAttribute("lazy","error")}).then(u=>{N(l,u),e(!0),A(l,"rc-lazyload__loaded"),l.setAttribute("lazy","loaded"),l.removeAttribute("data-src")})})},[e,a]);return[F(t,n),a]},ge=fe,Q=t=>{const{prefixCls:s,createNamespace:a}=d.useContext(O),[e]=a("lazyload-image",s),{style:n,type:o,height:r,width:i,image:l,errorImage:m,eventOptions:u,observerOptions:v,loading:E,className:p,onLoaded:b,...f}=t,[x,j]=ge(v,m);d.useEffect(()=>{var L;j&&((L=t.onLoaded)==null||L.call(t))},[j]);const g={...n,height:r,width:i};return c.jsx(c.Fragment,{children:o==="image"?d.createElement("img",{...f,ref:x,style:g,"data-src":l,src:E||S,className:y(e(),p)}):d.createElement("div",{...f,ref:x,style:g,"data-src":l,className:y(e(),p)},t.children)})};Q.defaultProps={image:"60",className:"",type:"image"};const he=Q,q=t=>{const[s,a]=d.useState(),{observer:e,...n}=t;return d.useEffect(()=>{(r=>{!H&&r===h.observer&&(r=h.event),a(r)})(e?h.observer:h.event)},[e]),c.jsx(c.Fragment,{children:s===h.event?c.jsx(me,{...n}):s===h.observer?c.jsx(he,{...n}):null})};q.defaultProps={loading:null,observer:!0,eventOptions:{scrollContainer:document.body,offset:0,debounce:300,throttle:0,listenEvents:C}};const pe=q,ve=Object.assign(de,{Image:pe}),z=ve;const we=()=>{const{DemoBlock:t,DemoSection:s}=Y,a=["https://img01.yzcdn.cn/vant/apple-1.jpg","https://img01.yzcdn.cn/vant/apple-2.jpg","https://img01.yzcdn.cn/vant/apple-3.jpg","https://img01.yzcdn.cn/vant/apple-4.jpg"],e=["https://img.yzcdn.cn/vant/apple-5.jpg","https://img.yzcdn.cn/vant/apple-6.jpg"],n=["https://img.yzcdn.cn/vant/apple-8.jpg","https://img.yzcdn.cn/vant/apple-7.jpg"],o=()=>c.jsx("div",{className:"spain-container",children:c.jsx(Z,{})});return c.jsxs(s,{children:[c.jsx(t,{title:"基础用法",children:a.map(r=>c.jsx(z.Image,{observer:!1,image:r},r))}),c.jsx(t,{title:"背景图片懒加载",children:e.map(r=>c.jsx(z.Image,{type:"background",height:"300px",image:r},r))}),c.jsx(t,{title:"懒加载模块",children:n.map(r=>c.jsx(z,{loading:c.jsx(o,{}),height:"250",children:c.jsx("img",{alt:"",src:r,width:"100%",height:"250"})},r))}),c.jsx(t,{title:"事件监听懒加载模块",children:n.map(r=>c.jsx(z,{observer:!1,loading:c.jsx(o,{}),children:c.jsx("img",{alt:"",src:r,width:"100%",height:"300"})},r))})]})};export{we as default};
