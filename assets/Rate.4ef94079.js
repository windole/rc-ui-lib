import{r as n,j as y,a as G}from"./react-libs.513007de.js";import{c as v}from"./locales.fc745e15.js";import{C as J}from"./ConfigProviderContext.ed273b22.js";import{b as K,a as E}from"./index.b2a8bc00.js";import{u as O}from"./use-touch.89e2aa83.js";function Q(){const s=n.exports.useRef([]),o=a=>t=>{s.current[a]=t};return[s.current,o]}const W=s=>{const{defaultValue:o,value:a}=s||{},[t,f]=n.exports.useState(()=>{if(a!==void 0)return a;if(o!==void 0)return typeof o=="function"?o():o}),h=a!==void 0?a:t;function l(i){f(i)}return[h,l]},Y=()=>n.exports.useEffect(()=>{const s=o=>o.preventDefault();return document.body.addEventListener("touchmove",s,{passive:!1}),()=>{document.body.removeEventListener("touchmove",s)}},[]),Z=(s,o,a,t)=>s>=o?{status:"full",value:1}:s+.5>=o&&a&&!t?{status:"half",value:.5}:s+1>=o&&a&&t?{status:"half",value:Math.round((s-o+1)*1e10)/1e10}:{status:"void",value:0},j=({count:s,touchable:o,onChange:a,...t})=>{const{prefixCls:f,createNamespace:h}=n.exports.useContext(J),[l]=h("rate",f),[i,k]=W({value:t.value,defaultValue:t.defaultValue}),L=n.exports.useRef(null),b=O(),[B,X]=Q(),I=()=>t.readonly||t.disabled||!o,$=n.exports.useMemo(()=>Array(s).fill("").map((e,r)=>Z(i,r+1,t.allowHalf,t.readonly)),[i,s]),c=n.exports.useRef(),x=()=>{const e=B.map(r=>r.getBoundingClientRect());c.current=[],e.forEach((r,u)=>{t.allowHalf?c.current.push({score:u+.5,left:r.left},{score:u+1,left:r.left+r.width/2}):c.current.push({score:u+1,left:r.left})})},S=e=>{for(let r=c.current.length-1;r>0;r--)if(e>c.current[r].left)return c.current[r].score;return t.allowHalf?.5:1},V=e=>{!t.disabled&&!t.readonly&&e!==i&&(k(e),a==null||a(e))},A=e=>{I()||(b.start(e),x())},D=e=>{if(!I()&&(b.move(e),b.isHorizontal())){const{clientX:r}=e.touches[0];V(S(r))}};Y();const F=(e,r)=>{const{icon:u,size:P,color:C,gutter:H,voidIcon:T,voidColor:p,disabled:d,disabledColor:w,allowHalf:M,iconPrefix:N}=t,g=r+1,R=e.status==="full",m=e.status==="void",U=M&&e.value>0&&e.value<1;let z;H&&g!==+s&&(z={paddingRight:K(H)});const _=q=>{x(),V(M?S(q.clientX):g)};return G("div",{ref:X(r),role:"radio",style:z,className:v(l("item")),tabIndex:0,"aria-setsize":parseInt(s==null?void 0:s.toString(),10),"aria-posinset":g,"aria-checked":!m,onClick:_,children:[y(E,{size:P,name:R?u:T,className:v(l("icon",{disabled:d,full:R})),color:d?w:R?C:p,classPrefix:N}),U&&y(E,{size:P,style:{width:`${e.value}em`},name:m?T:u,className:v(l("icon",["half",{disabled:d,full:!m}])),color:d?w:m?p:C,classPrefix:N})]},r)};return y("div",{ref:L,role:"radiogroup",className:v(l({readonly:t.readonly,disabled:t.disabled})),tabIndex:0,onTouchStart:e=>A(e),onTouchMove:e=>D(e),children:$.map(F)})};j.defaultProps={size:20,count:5,gutter:4,icon:"star",voidIcon:"star-o",touchable:!0};const ae=j;export{ae as R,W as a,Y as b,Q as u};
