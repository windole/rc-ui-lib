import{j as i,c as ee}from"./locales-548059eb.js";import{r as m}from"./react-libs-840bfe49.js";import{c as te}from"./rc-cli_site-mobile-demo-eaa39090.js";import{P as z}from"./Picker-38a496e4.js";import{c as G}from"./unit-bb3e6514.js";import{d as J}from"./raf-f0838b14.js";import{u as K}from"./use-ref-state-6962d29d.js";import{p as j}from"./string-4e3cebce.js";import{u as L}from"./use-update-effect-09c1ca0c.js";import{r as Z}from"./number-b57f7cd4.js";import{C as ne}from"./ConfigProviderContext-0f984393.js";import{T as ae}from"./index-ec9d0b36.js";import{F as re}from"./Field-bf6f7ff1.js";import{P as ie}from"./Popup-a2a0dcda.js";import"./mobile-e0307386.js";import"./use-gesture-react.esm-484f41f1.js";import"./base-1da74170.js";import"./bound-41eb6e06.js";import"./use-set-state-898f20ed.js";import"./Loading-c60598b2.js";import"./use-refs-92151253.js";import"./constant-7552c2aa.js";import"./use-event-listener-721bbec6.js";import"./event-07a78c2b.js";import"./lock-click-c7a7fb0f.js";import"./index-59db7e48.js";import"./render-38a34f7f.js";import"./index-9549eced.js";import"./index-7a676a8e.js";import"./index-9cdb6f61.js";import"./index-cffeb12c.js";import"./use-height-bc7f71cd.js";import"./get-rect-4dc7f7e4.js";import"./scroll-e4e20d56.js";import"./Overlay-d703c016.js";import"./use-touch-76dedc34.js";import"./use-scroll-parent-a4dd715d.js";import"./CSSTransition-ea203202.js";import"./interceptor-35467a90.js";import"./PopupContext-0557b73d.js";function Q(e,x){if(e<0)return[];let D=-1;const u=Array(e);for(;++D<e;)u[D]=x(D);return u}function oe(e){if(!e)return 0;for(;G(parseInt(e,10));)if(e.length>1)e=e.slice(1);else return 0;return parseInt(e,10)}function _(e,x){return 32-new Date(e,x-1,32).getDate()}function ue(e){return Object.prototype.toString.call(e)==="[object Date]"&&!G(e.getTime())}const U=m.forwardRef((e,x)=>{const{value:D,formatter:u,columnsOrder:y,type:H,filter:n,minDate:f,maxDate:$,...E}=e,I=t=>(ue(t)||(t=e.minDate),t=Math.max(new Date(t).getTime(),e.minDate.getTime()),t=Math.min(t,e.maxDate.getTime()),new Date(t)),k=m.useRef(null),[s,V,R]=K(I(D)),o=(t,a)=>{const r=e[`${t}Date`],d=r.getFullYear();let C=1,g=1,v=0,P=0;return t==="max"&&(C=12,g=_(a.getFullYear(),a.getMonth()+1),v=23,P=59),a.getFullYear()===d&&(C=r.getMonth()+1,a.getMonth()+1===C&&(g=r.getDate(),a.getDate()===g&&(v=r.getHours(),a.getHours()===v&&(P=r.getMinutes())))),{[`${t}Year`]:d,[`${t}Month`]:C,[`${t}Date`]:g,[`${t}Hour`]:v,[`${t}Minute`]:P}},l=m.useMemo(()=>{const{maxYear:t,maxDate:a,maxMonth:r,maxHour:d,maxMinute:C}=o("max",R.current),{minYear:g,minDate:v,minMonth:P,minHour:F,minMinute:N}=o("min",R.current);let h=[{type:"year",range:[g,t]},{type:"month",range:[P,r]},{type:"day",range:[v,a]},{type:"hour",range:[F,d]},{type:"minute",range:[N,C]}];switch(e.type){case"date":h=h.slice(0,3);break;case"year-month":h=h.slice(0,2);break;case"month-day":h=h.slice(1,3);break;case"datehour":h=h.slice(0,4);break}if(y){const S=y.concat(h.map(Y=>Y.type));h.sort((Y,B)=>S.indexOf(Y.type)-S.indexOf(B.type))}return h},[y,e.type,R.current]),c=m.useMemo(()=>l.map(({type:t,range:a})=>{let r=Q(a[1]-a[0]+1,d=>j(a[0]+d));return n&&(r=n(t,r)),{type:t,values:r}}),[n,l]),w=m.useMemo(()=>c.map(t=>({values:t.values.map(a=>u(t.type,a))})),[c,u]),T=m.useCallback(()=>{const t=c.map(a=>{switch(a.type){case"year":return u("year",`${s.getFullYear()}`);case"month":return u("month",j(s.getMonth()+1));case"day":return u("day",j(s.getDate()));case"hour":return u("hour",j(s.getHours()));case"minute":return u("minute",j(s.getMinutes()));default:return null}});J(()=>{var a;(a=k.current)==null||a.setValues(t)})},[s,u,c]),b=t=>{const{type:a}=e,r=N=>{let h=0;c.forEach((Y,B)=>{N===Y.type&&(h=B)});const{values:S}=c[h];return oe(S[t[h]])};let d=null,C=null,g=null;a==="month-day"?(d=(s||e.minDate).getFullYear(),C=r("month"),g=r("day")):(d=r("year"),C=r("month"),g=a==="year-month"?1:r("day"));const v=_(d,C);g=g>v?v:g;let P=0,F=0;return a==="datehour"&&(P=+r("hour")),a==="datetime"&&(P=+r("hour"),F=+r("minute")),I(new Date(d,C-1,g,P,F))},O=()=>{var t;if(k.current){const a=k.current.getIndexes(),r=b(a);r&&r.valueOf()!==(s==null?void 0:s.valueOf())&&V(r),(t=e.onChange)==null||t.call(e,r)}},X=()=>{var t,a;if(k.current){const r=(t=k.current)==null?void 0:t.getIndexes(),d=b(r);d&&d.valueOf()!==(s==null?void 0:s.valueOf())&&V(d),(a=e.onConfirm)==null||a.call(e,d)}};m.useEffect(()=>{T()},[T]);const{minDate:A,maxDate:p}=e;return L(()=>{const t=I(D);t&&t.valueOf()!==(s==null?void 0:s.valueOf())&&V(t)},[D,n,A,p]),m.useImperativeHandle(x,()=>({getPicker:()=>k.current})),i.jsx(z,{...E,ref:k,columns:w,onChange:O,onConfirm:X,onCancel:e.onCancel})}),q=new Date().getFullYear();U.defaultProps={type:"datetime",minDate:new Date(q-10,0,1),maxDate:new Date(q+10,11,31),formatter:(e,x)=>x};U.displayName="DatePicker";const me=m.memo(U),W=m.forwardRef((e,x)=>{const D=o=>{const{minHour:l,maxHour:c,minMinute:w,maxMinute:T}=e;o||(o=`${j(l)}:${j(l)}`);let[b,O]=o.split(":");return b=j(Z(+b,+l,+c)),O=j(Z(+O,+w,+T)),`${b}:${O}`},u=m.useRef(null),[y,H,n]=K(D(e.value)),f=m.useMemo(()=>[{type:"hour",range:[+e.minHour,+e.maxHour]},{type:"minute",range:[+e.minMinute,+e.maxMinute]}],[e.minHour,e.maxHour,e.minMinute,e.maxMinute]),$=m.useMemo(()=>f.map(({type:o,range:l})=>{let c=Q(l[1]-l[0]+1,w=>j(l[0]+w));return e.filter&&(c=e.filter(o,c)),{type:o,values:c}}),[f,e.filter]),E=m.useMemo(()=>$.map(o=>({values:o.values.map(l=>e.formatter(o.type,l))})),[$]),I=m.useCallback(()=>{const o=y.split(":"),l=[e.formatter("hour",o[0]),e.formatter("minute",o[1])];J(()=>{var c;(c=u.current)==null||c.setValues(l)})},[y,e.formatter]),k=o=>{const[l,c]=o,[w,T]=$,b=w.values[l]||w.values[0],O=T.values[c]||T.values[0];return D(`${b}:${O}`)},s=()=>{var o;return(o=e.onConfirm)==null?void 0:o.call(e,y)},V=()=>e.onCancel(),R=o=>{var l;if(u.current){const c=u.current.getIndexes(),w=k(c);H(w),(l=e.onChange)==null||l.call(e,w)}};return m.useEffect(()=>{I()},[I]),L(()=>{const o=D(e.value);o!==y&&H(o)},[e.value,e.filter,e.minHour,e.maxHour,e.minMinute,e.maxMinute]),m.useImperativeHandle(x,()=>({getPicker:()=>u.current})),i.jsx(z,{ref:u,columns:E,readonly:e.readonly,onChange:R,onCancel:V,onConfirm:s})});W.defaultProps={minHour:0,maxHour:23,minMinute:0,maxMinute:59,formatter:(e,x)=>x};const le=W,ce=m.forwardRef((e,x)=>{const{prefixCls:D,createNamespace:u}=m.useContext(ne),[y]=u("datetime-picker",D),n=e.type==="time"?le:me;return i.jsx(n,{ref:x,className:ee(y()),...e})}),M=ce,Xe=()=>{const{DemoBlock:e,DemoSection:x}=te,[D,u]=m.useState(""),[y,H]=m.useState(!1);return i.jsxs(x,{children:[i.jsx(e,{card:!0,title:"选择年月日",children:i.jsx(M,{title:"选择年月日",type:"date",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,onChange:n=>console.log(n)})}),i.jsx(e,{card:!0,title:"选择年月",children:i.jsx(M,{type:"year-month",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,formatter:(n,f)=>n==="year"?`${f}年`:n==="month"?`${f}月`:f,onChange:n=>console.log(n)})}),i.jsx(e,{card:!0,title:"选择月日",children:i.jsx(M,{type:"month-day",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,formatter:(n,f)=>n==="month"?`${f}月`:n==="day"?`${f}日`:f})}),i.jsx(e,{card:!0,title:"选择时间",children:i.jsx(M,{type:"time",minHour:"10",maxHour:"20",value:"12:00",onChange:n=>console.log(n),onConfirm:n=>console.log(n)})}),i.jsx(e,{card:!0,title:"选择完整时间",children:i.jsx(M,{type:"datetime",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),i.jsx(e,{card:!0,title:"选择年月日小时",children:i.jsx(M,{type:"datehour",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),i.jsx(e,{card:!0,title:"选择过滤器",children:i.jsx(M,{type:"time",minHour:"10",maxHour:"20",value:"12:00",filter:(n,f)=>n==="minute"?f.filter($=>+$%5===0):f})}),i.jsx(e,{card:!0,title:"自定义列排序",children:i.jsx(M,{type:"date",columnsOrder:["month","day","year"],minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),i.jsx(e,{card:!0,title:"确认按钮",children:i.jsx(M,{onConfirm:n=>ae(`确认的日期：${n}`),type:"date",minDate:new Date(2021,0,1),maxDate:new Date(2021,2,1),value:new Date})}),i.jsx(e,{card:!0,title:"搭配弹出层使用",children:i.jsx(re,{readonly:!0,clickable:!0,label:"日期",value:D,placeholder:"选择选择日期",onClick:()=>H(!0)})}),i.jsx(ie,{title:"请选择日期",closeable:!0,visible:y,round:!0,position:"bottom",onClose:()=>H(!1),children:i.jsx("div",{style:{padding:"0 8px"},children:i.jsx(M,{onConfirm:n=>{u(n.toISOString()),H(!1)},type:"date",filter:(n,f)=>n==="minute"?f.filter($=>+$%5===0):f,minDate:new Date(2021,0,1),maxDate:new Date(2021,2,1),value:new Date})})})]})};export{Xe as default};
