import{j as s,c as r}from"./locales-548059eb.js";import{r as g}from"./react-libs-840bfe49.js";import{a as y}from"./index-59db7e48.js";import{S as v}from"./index-945c9dff.js";import{P as Z,r as R}from"./Popup-a2a0dcda.js";import{u as S,c as k,b as D}from"./use-gesture-react.esm-484f41f1.js";import{I as T}from"./Image-d312b6e1.js";import{C as P}from"./ConfigProviderContext-0f984393.js";import{p as $,n as w}from"./base-1da74170.js";import{r as E,u as z}from"./render-38a34f7f.js";const M=e=>{const{prefixCls:f,createNamespace:d}=g.useContext(P),[a]=d("image-preview",f),[{zoom:i,x:n,y:c},m]=S(()=>({zoom:1,x:0,y:0,config:{tension:300}})),C=k({onDrag:o=>{if(o.tap&&o.elapsedTime>0){e.onTap();return}const[u,t]=o.swipe;if(i.get()<=1||u!==0||t!==0)m.start({x:0,y:0,immediate:!0});else{const[x,I]=o.offset;m.start({x,y:I,immediate:!0})}},onPinch:o=>{var l;const[u]=o.offset,t=o.last?Math.max(Math.min(u,e.maxZoom),1):u;m.start({zoom:t,immediate:!o.last}),(l=e.onZoomChange)==null||l.call(e,t),o.last&&t<=1&&m.start({x:0,y:0,immediate:!0})}},{drag:{from:()=>[n.get(),c.get()]},pinch:{distanceBounds:{min:1,max:e.maxZoom},rubberband:!0,from:()=>[i.get(),0]}});return s.jsx("div",{className:r(a("slide")),"data-testid":"slide",onPointerMove:o=>{i.get()!==1&&o.stopPropagation()},children:s.jsx("div",{className:r(a("control")),...C(),"data-testid":"control",children:s.jsx(D.div,{className:r(a("image-wrapper")),style:{scale:i,x:n,y:c},children:s.jsx(T,{fit:"contain",src:e.image,className:r(a("image")),onClick:()=>{var o;(o=e.onTap)==null||o.call(e)}})})})})},X=M,N=e=>{const{prefixCls:f,createNamespace:d}=g.useContext(P),[a]=d("image-preview",f),i=g.useRef(null),[n,c]=g.useState(()=>e.startPosition),m=t=>{var l;n!==t&&(c(t),(l=e.onChange)==null||l.call(e,t))},C=()=>s.jsx(v,{ref:i,className:r(a("swipe")),loop:e.loop,autoplayInterval:e.swipeDuration,defaultIndex:n,onIndexChange:m,indicator:e.showIndicators,children:e.images.map((t,l)=>s.jsx(v.Item,{className:r(a("item")),children:s.jsx(X,{maxZoom:e.maxZoom,image:t,onTap:()=>{var x;(x=e.onClose)==null||x.call(e,{url:t,index:l})},onZoomChange:x=>{var I,h;x!==1?(I=i.current)==null||I.lock():(h=i.current)==null||h.unlock()}})},t))}),o=()=>e.closeable?s.jsx(y,{name:e.closeIcon,className:r(a("close-icon",e.closeIconPosition)),onClick:()=>{var t;return(t=e.onClose)==null?void 0:t.call(e)}}):null,u=()=>e.showIndex?s.jsx("div",{className:r(a("index")),children:e.indexRender?e.indexRender({index:n,len:e.images.length}):`${n+1} / ${e.images.length}`}):null;return s.jsxs(Z,{className:r(a(),e.className),overlayClass:r(a("overlay")),beforeClose:e.beforeClose,...$(e,["visible","overlayStyle","closeOnPopstate","onClose","onClosed"]),children:[o(),C(),u()]})};N.defaultProps={loop:!0,overlay:!0,showIndex:!0,images:[],swipeDuration:300,startPosition:0,closeIcon:"clear",closeIconPosition:"top-right",showIndicators:!1,maxZoom:3};const b=N,j=b,B={loop:!0,images:[],className:"",showIndex:!0,closeable:!1,closeIcon:"clear",startPosition:0,swipeDuration:300,closeOnPopstate:!0,closeIconPosition:"top-right"};j.open=e=>{const{onClose:f=w,beforeClose:d,...a}=e,i=R(e.teleport),n=document.createElement("div");i.appendChild(n);let c=w;const m=()=>{const[C,o]=g.useState(!1);g.useEffect(()=>{o(!0)},[]),c=t=>{o(!1),f&&f(t)};const u=async t=>await(d==null?void 0:d(0))!==!1?(c(t),z(n)&&n.parentNode&&n.parentNode.removeChild(n),!0):!1;return s.jsx(b,{...B,...a,visible:C,teleport:()=>n,onClose:c,beforeClose:u})};return E(s.jsx(m,{}),n),{close:c}};const K=j;export{K as I};
